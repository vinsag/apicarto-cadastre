/*eslint-env node, mocha */
var test = require('unit.js');
// var valeurGeometry = { 'type': 'FeatureCollection','features': [{ 'type': 'Feature','geometry': {'type': 'Point', 'coordinates': [102.0, 0.5]},'properties': {'prop0': 'value0'} }]};
var geojson_intersect = require('../lib/geojson_intersection.js') ;

describe('test geojson_intersect', function() {
    
   
    /* Test du polygon */
    it('should work for feature Polygon', function(){
      /*  var poly1 = {
  "type": "Feature",
  "properties": {
    "fill": "#0f0"
  },
  "geometry": {
    "type": "Polygon",
    "coordinates": [[
      [-122.801742, 45.48565],
      [-122.801742, 45.60491],
      [-122.584762, 45.60491],
      [-122.584762, 45.48565],
      [-122.801742, 45.48565]
    ]]
  }
}
/*var poly2 = {
  "type": "Feature",
  "properties": {
    "fill": "#00f"
  },
  "geometry": {
    "type": "Polygon",
    "coordinates": [[
      [-122.520217, 45.535693],
      [-122.64038, 45.553967],
      [-122.720031, 45.526554],
      [-122.669906, 45.507309],
      [-122.723464, 45.446643],
      [-122.532577, 45.408574],
      [-122.487258, 45.477466],
      [-122.520217, 45.535693]
    ]]
  }
}*/

var inputInitial = {"type":"Feature","geometry":{"type":"Polygon","coordinates":[[[4.79628704723532,45.2245686201141],[4.79627198205696,45.2244810075761],[4.79623301978841,45.2243971554783],[4.7961716578197,45.2243202861855],[4.7960902543159,45.2242533537068],[4.79599193758517,45.2241989301793],[4.795880485857,45.2241591070292],[4.79611074606575,45.2248898851649],[4.79618775879377,45.2248204057315],[4.7962441106954,45.2247416438072],[4.79627763626632,45.2246566262013],[4.79628704723532,45.2245686201141]]]}};
 var inputResultat = {"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"MultiPolygon","coordinates":[[[[4.796741,45.2246689],[4.796728,45.2245008],[4.7967165,45.22445],[4.7966851,45.2243425],[4.7966693,45.2243111],[4.7965761,45.2241572],[4.7965678,45.2241226],[4.7965632,45.2240786],[4.7962522,45.2240546],[4.7962169,45.2240522],[4.7960701,45.2240398],[4.7957599,45.2239614],[4.7957229,45.2239057],[4.7956941,45.2238651],[4.7957149,45.2240836],[4.7957182,45.2241262],[4.795716,45.2241485],[4.7957101,45.2241693],[4.7957319,45.2241791],[4.7962822,45.2244462],[4.7963109,45.2244585],[4.7965088,45.2245584],[4.796741,45.2246689]]]]},"properties":{"surface_parcelle":3077.67658051249,"numero":"0600","feuille":4,"section":"0B","code_dep":"07","nom_com":"Andance","code_com":"009","code_arr":"000"}},{"type":"Feature","geometry":{"type":"MultiPolygon","coordinates":[[[[4.7947745,45.2237194],[4.7946822,45.223674],[4.7943568,45.2240578],[4.7946338,45.2240871],[4.7948682,45.2241196],[4.7951076,45.2241559],[4.7953378,45.2242045],[4.7953939,45.2242194],[4.7955169,45.2242752],[4.7956826,45.2243554],[4.7958368,45.2244331],[4.7961689,45.224605],[4.7962746,45.2246661],[4.7963587,45.2247301],[4.7963841,45.2247549],[4.796384,45.2247749],[4.7965088,45.2245584],[4.7963109,45.2244585],[4.7962822,45.2244462],[4.7957319,45.2241791],[4.7957101,45.2241693],[4.7953983,45.224019],[4.7953896,45.2240475],[4.7945926,45.2239197],[4.7947745,45.2237194]]]]},"properties":{"surface_parcelle":3553.4346971710215,"numero":"0604","feuille":4,"section":"0B","code_dep":"07","nom_com":"Andance","code_com":"009","code_arr":"000"}},{"type":"Feature","geometry":{"type":"MultiPolygon","coordinates":[[[[4.7959948,45.2247219],[4.796405,45.2251348],[4.796741,45.2246689],[4.7965088,45.2245584],[4.796384,45.2247749],[4.7963813,45.2247818],[4.7963625,45.2248016],[4.7963316,45.2248137],[4.7962947,45.2248161],[4.7962418,45.2248072],[4.7961785,45.2247872],[4.7959948,45.2247219]]]]},"properties":{"surface_parcelle":1345.1783065858317,"numero":"0601","feuille":4,"section":"0B","code_dep":"07","nom_com":"Andance","code_com":"009","code_arr":"000"}},{"type":"Feature","geometry":{"type":"MultiPolygon","coordinates":[[[[4.7957455,45.224419],[4.795777,45.2246122],[4.7959112,45.224656],[4.7961871,45.2247563],[4.7962603,45.2247764],[4.7963051,45.224782],[4.7963304,45.2247764],[4.7963389,45.2247658],[4.7963351,45.2247493],[4.7963171,45.2247298],[4.796249,45.2246862],[4.7961706,45.2246511],[4.7960362,45.2245785],[4.7959426,45.2245252],[4.7958233,45.2244596],[4.7957455,45.224419]]]]},"properties":{"surface_parcelle":605.787297429463,"numero":"0603","feuille":4,"section":"0B","code_dep":"07","nom_com":"Andance","code_com":"009","code_arr":"000"}},{"type":"Feature","geometry":{"type":"MultiPolygon","coordinates":[[[[4.7961739,45.2254566],[4.7963912,45.2251561],[4.796405,45.2251348],[4.7959948,45.2247219],[4.7959106,45.2246913],[4.7957695,45.2246457],[4.7957114,45.2246342],[4.7956018,45.2246238],[4.7954003,45.2246075],[4.7951859,45.2245917],[4.7951312,45.2245911],[4.7951093,45.224598],[4.7951471,45.2246219],[4.7952172,45.2246709],[4.7952683,45.2247081],[4.7953679,45.2247638],[4.7954002,45.2247913],[4.7954255,45.224816],[4.7954502,45.2248486],[4.7954725,45.2248798],[4.7955122,45.2249234],[4.7955489,45.2249617],[4.7955822,45.2249933],[4.7956153,45.2250206],[4.7957181,45.2250846],[4.7957505,45.2251125],[4.7957787,45.2251387],[4.7958312,45.2251896],[4.7958553,45.2252118],[4.7958876,45.2252294],[4.7959248,45.2252436],[4.7959674,45.2252576],[4.7959974,45.2252746],[4.7960245,45.2252945],[4.7960477,45.2253174],[4.7960735,45.225358],[4.7961004,45.2253953],[4.7961217,45.225423],[4.796153,45.2254435],[4.7961739,45.2254566]]]]},"properties":{"surface_parcelle":3870.9551936204057,"numero":"0602","feuille":4,"section":"0B","code_dep":"07","nom_com":"Andance","code_com":"009","code_arr":"000"}}]};

        var result = geojson_intersect(inputResultat.features[0],inputInitial);
        console.log(result);
    });
    
    
    /* Test du feature Collection Multipolygon */
   /* 
    it('should work for feature Collection Multipolygon', function(){
        var input = {
            type: 'FeatureCollection',
            features: [
                {
                    type: 'Feature',
                    geometry: {
                        type: 'MultiPolygon',
                        coordinates: [
                            [[[102.0, 2.0], [103.0, 2.0], [103.0, 3.0], [102.0, 3.0], [102.0, 2.0]]],
                            [
                                [[100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0]],
                                [[100.2, 0.2], [100.8, 0.2], [100.8, 0.8], [100.2, 0.8], [100.2, 0.2]]
                            ]
                        ]
                    }
                }
            ]
        };
        var expected = {
            type: 'FeatureCollection',
            features: [
                {
                    type: 'Feature',
                    geometry: {
                        type: 'MultiPolygon',
                        coordinates: [
                            [[[2.0, 102.0], [2.0, 103.0], [3.0, 103.0], [3.0, 102.0], [2.0, 102.0]]],
                            [
                                [[0.0, 100.0], [0.0, 101.0], [1.0, 101.0], [1.0, 100.0], [0.0, 100.0]],
                                [[0.2, 100.2], [0.2, 100.8], [0.8, 100.8], [0.8, 100.2], [0.2, 100.2]]
                            ]
                        ]
                    }
                }
            ]
        };
        var result = geojson_flip_lonlat(input);
        // console.log(JSON.stringify(result));
        test.value(JSON.stringify(result)).isEqualTo(JSON.stringify(expected));
    });*/
   
});
